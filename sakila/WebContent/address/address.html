<!DOCTYPE html>
<html>
<head>
<title>sakila index</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body {
        padding: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-position: 0 0;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-size: cover;
        position: relative;
        overflow-y: auto;
    }
    
    #aside {
        width: 200px;
        height: 3000px;
        position: fixed;
        background: orange;
        overflow: hidden;
        float: left;
    }
    
    #section {
        margin-left: 300px;
        margin-right: 500px;
        margin-bottom: 100px;
        background: white;
    }
</style>
</head>
<body>
    <div id="aside">
        <h1>MENU</h1>

    </div>
    <div id="section">
        <h1>Address</h1>
        <h2>add address</h2>
        <table>
         <tr>
            <td>
               <!-- 국가 선택 -->
               <div>
                  <select size="10" id="countryList">
                  </select>
               <!-- selecting city -->
                  <select size="10" id="cityList">
                  </select>
               </div>               
            </td>         
            <td>               
               coutry_id: <input type="text" id="countryId" readonly="readonly"><hr>
               city_id: <input type="text" id="cityId" readonly="readonly"><hr>
               address: <input type="text" id="address" ><hr>
               address2: <input type="text" id="address2" ><hr>
               district: <input type="text" id="district" ><hr>
               postal_code: <input type="text" id="postal_code" ><hr>
               phone: <input type="text" id="phone" ><hr>
               <button type="button" id="addAddress"> insert > </button><hr>
            </td>
         </tr>
      </table>
        
        <h2>address 목록</h2>		
		<div>
			<table border="1">
				<thead>
					<tr>
						<th>coutry_id :</th>
						<th>address:</th>
						<th>address2 :</th>
						<th>district :</th>
						<th>city_id :</th>
						<th>postal_code :</th>
						<th>phone :</th>
						<th>last_update :</th>
					</tr>
				</thead>
				<tbody id="list">

				</tbody>
			</table>
		</div>
    </div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>$("#aside").load("/sakila/aside.html");</script>
<script>
	
	$.ajax({
		url : "/sakila/address/selectCountryListAll",
		method : "POST",
		success : function(json){
			$("#countryList").empty(); //countryList 초기화
			$(json).each(function(index, item){ //each 반복문  <--json 만큼 반복
				temp ="<option value='";
				temp += item.countryId;
				temp += "'>";
				temp += item.country;
				temp += "</option>";
				$("#countryList").append(temp);
			});
		}
	});
	
	   // 나라 선택시 나라 번호 출력 / city list select
	   $("#countryList").change(function(){
	      $("#countryId").val($("#countryList").val());   // countryId값이 있을 장소에 countryList의 값을 넣는다.
	      $("#cityList").empty();
	      // when country selected -> 도시 목록 출력
	      $.ajax({
	         url:"/sakila/address/selectCityListByCountry", 
	         method: "POST",
	         data : {"countryId" : $("#countryList").val()},
	         success : function(json){
	            $(json).each(function(index, item){
	               temp="<option value='";
	               temp+=item.cityId;
	               temp+="'>";
	               temp+=item.city;
	               temp+="</option>";
	               $("#cityList").append(temp);
	            });
	         }
	      });
	   });
	   // 도시 선택시 도시 번호 출력 
	   $("#cityList").change(function(){
	      $("#cityId").val($("#cityList").val());
	   });
	
	$("#countryList").change(function(){ 
		$.ajax({
			url : "/sakila/address/selectCityListByCountry",
			method : "POST",
			data : {"countryId" : $("#countryList").val()},
			success : function(json){
				$("#cityList").empty(); //countryList 초기화
				$(json).each(function(index, item){ //each 반복문  <--json 만큼 반복
					temp ="<option value='";
					temp += item.cityId;
					temp += "'>";
					temp += item.city;
					
					
					temp += "</option>";
					$("#cityList").append(temp);
				});
			}
		});
	});
	//기존의 리스트 불러오기
	$("#list").empty();
	$.ajax({
		url : "/sakila/address/selectAddressList",
		method : "post",
		success : function(json){ //json -> 자바스크립트의 객체로 변경							
		console.log(json);
		for(let c of json){
			let html = "<tr>";
			html += "<td>"+c.addressId+"</td>";
			html += "<td>"+c.address+"</td>";
			html += "<td>"+c.address2+"</td>";
			html += "<td>"+c.district+"</td>";
			html += "<td>"+c.city.cityId+"</td>";
			html += "<td>"+c.postalCode+"</td>";
			html += "<td>"+c.phone+"</td>";
			html += "<td>"+c.lastUpdate+"</td>";
			html += "</tr>";
			$("#list").append(html);
			}							
		}					
	});  
	
	
	
</script>
</html>